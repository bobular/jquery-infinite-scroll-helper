(function(g,e){var f="infiniteScrollHelper",d="plugin_"+f;var h={bottomBuffer:0,debounceInt:100,doneLoading:null,interval:300,loadingClass:"loading",loadingClassTarget:null,loadMoreDelay:0,loadMore:g.noop,startingPageCount:1,triggerInitialLoad:false};function c(j,i){this.options=g.extend({},h,i);this.$element=g(j);this.$win=g(e);this.$loadingClassTarget=this._getLoadingClassTarget();this.$scrollContainer=this._getScrollContainer();this.loading=false;this.doneLoadingInt=null;this.pageCount=this.options.triggerInitialLoad?this.options.startingPageCount-1:this.options.startingPageCount;this.destroyed=false;this._init()}c.prototype._init=function(){this._addListeners();if(this.options.triggerInitialLoad){this._beginLoadMore(this.options.loadMoreDelay)}else{this._handleScroll()}};c.prototype._getLoadingClassTarget=function(){return this.options.loadingClassTarget?g(this.options.loadingClassTarget):this.$element};c.prototype._getScrollContainer=function(){var i=null;if(this.$element.css("overflow-y")=="auto"){i=this.$element}if(!i){i=this.$element.parents().filter(function(){return g(this).css("overflow-y")=="auto"})}i=i.length>0?i:this.$win;return i};c.prototype._addListeners=function(){var i=this;this.$scrollContainer.on("scroll."+f,b(function(){i._handleScroll()},this.options.debounceInt))};c.prototype._removeListeners=function(){this.$scrollContainer.off("scroll."+f)};c.prototype._handleScroll=function(j){var i=this;if(this._shouldTriggerLoad()){this._beginLoadMore(this.options.loadMoreDelay);if(this.options.doneLoading){this.doneLoadingInt=setInterval(function(){if(i.options.doneLoading(i.pageCount)){i._endLoadMore()}},this.options.interval)}}};c.prototype._shouldTriggerLoad=function(){var j=this._getElementHeight(),i=this.$scrollContainer.scrollTop()+this.$scrollContainer.height()+this.options.bottomBuffer;return(!this.loading&&i>=j&&this.$element.is(":visible"))};c.prototype._getElementHeight=function(){if(this.$element==this.$scrollContainer){return this.$element[0].scrollHeight}else{return this.$element.height()}};c.prototype._beginLoadMore=function(i){i=i||0;setTimeout(g.proxy(function(){this.pageCount++;this.options.loadMore(this.pageCount,g.proxy(this._endLoadMore,this));this.$loadingClassTarget.addClass(this.options.loadingClass)},this),i);this.loading=true;this._removeListeners()};c.prototype._endLoadMore=function(){clearInterval(this.doneLoadingInt);this.loading=false;this.$loadingClassTarget.removeClass(this.options.loadingClass);!this.destroyed&&this._addListeners()};c.prototype.destroy=function(){this._removeListeners();this.options.loadMore=null;this.options.doneLoading=null;g.data(this.$element[0],d,null);clearInterval(this.doneLoadingInt);this.destroyed=true};function a(i,k,j){if(i&&g.isFunction(i[k])){i[k].apply(i,j)}}function b(j,l,i){var k;return function(){var p=this,o=arguments;var n=function(){k=null;if(!i){j.apply(p,o)}};var m=i&&!k;clearTimeout(k);k=setTimeout(n,l);if(m){j.apply(p,o)}}}g.fn[f]=function(j){var k=false,i=arguments;if(typeof j=="string"){k=j}return this.each(function(){var l=g.data(this,d);if(!l&&!k){g.data(this,d,new c(this,j))}else{if(k){a(l,k,Array.prototype.slice.call(i,1))}}})};e.InfiniteScrollHelper=e.InfiniteScrollHelper||c})(jQuery,window);